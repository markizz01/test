


|**Название**|**Вес**|
| - | - |
|<p>[1. Configuring Microsoft AD FS for Rancher]( ) </p><p>1. Настройка Microsoft AD FS для Rancher[^1]</p>|1205|

`	`Перед настройкой Rancher для поддержки пользователей AD FS необходимо добавить Rancher в качестве [объекта ]( o )[*relying party trust*]( o ) в AD FS.

1. Войдите на свой сервер AD как пользователь-администратор.
1. Откройте консоль **AD FS Management** (управление AD FS). Выберите **Add Relying Party Trust…** (добавить объект *relying party trust*) в меню **Actions** (действия) и нажмите **Start** (старт).



1. Выберите **Enter data about the relying party manually** (вручную ввести данные о *relying party*) в качестве параметра для получения данных о *relying party*.


1. Введите желаемое **Display name** (отображаемое имя) для вашего объекта Relying Party Trust. Например, Rancher.


1. Выберите **AD FS profile** (профиль AD FS) в качестве профиля конфигурации для вашего объекта *relying party trust*.


1. Оставьте **optional token encryption certificate** (дополнительный сертификат шифрования токена) пустым, так как Rancher AD FS не будет его использовать.


1. Выберите **Enable support for the SAML 2.0 WebSSO protocol** (включить поддержку протокола SAML 2.0 WebSSO) и введите https://<rancher-server>/v1-saml/adfs/saml/acs в качестве URL-адреса сервиса.


1. Добавьте https://<rancher-server>/v1-saml/adfs/saml/metadata в качестве **Relying party trust identifier**  (идентификатора объекта *relying party trust*).


1. В этом туториале не рассматривается многофакторная аутентификация; пожалуйста, обратитесь к [документации Microsoft]( ), если вы хотите настроить многофакторную аутентификацию.


1. В разделе **Choose Issuance Authorization Rules** (выбрать правила авторизации выдачи) вы можете выбрать любой из доступных вариантов в зависимости от варианта использования. Однако в данном случае выберите **Permit all users to access this relying party** (разрешить всем пользователям доступ к этой *relying party*).


1. После просмотра ваших настроек выберите **Next** (далее), чтобы добавить объект *relying party trust*.


1. Выберите **Open the Edit Claim Rules...** (открыть правила редактирования утверждений) и нажмите кнопку **Close** (закрыть).


1. На вкладке **Issuance Transform Rules** (правила преобразования выдачи) нажмите **Add Rule...** (добавить правило).



1. Выберите **Send LDAP Attributes as Claims** (отправить атрибуты LDAP в качестве утверждений) в качестве **Claim rule template** (шаблона правила утверждения).


1. Задайте **Claim rule name** (название правила утверждения) равным желаемому имени (desired name), например, Rancher Attributes, и выберите **Active Directory** в качестве **Attribute store** (хранилища атрибутов). Создайте следующее сопоставление (см. картинку ниже):


|<p>Атрибут LDAP</p><p>**LDAP атрибут[^2]**</p>|<p>Тип исходящего утверждения</p><p>**Outgoing Claim Type[^3]**</p>|
| :-: | :-: |
|Given-Name|Given Name|
|User-Principal-Name|UPN|
|Token-Groups - Qualified by Long Domain Name|Group|
|SAM-Account-Name|Name|



1. Скачать federationmetadata.xml с вашего сервера AD по адресу:

https://<AD\_SERVER>/federationmetadata/2007-06/federationmetadata.xml

**Результат:** Вы добавили Rancher в качестве объекта *relying trust party*. Теперь вы можете настроить Rancher для использования AD.

Ссылка на документацию

"Далее: Настройка Rancher для Microsoft AD FS"

https://github.com/rancher/docs/blob/master/content/rancher/v2.6/en/admin-settings/authentication/microsoft-adfs/microsoft-adfs-setup/%7B%7B%3Cbaseurl%3E%7D%7D/rancher/v2.6/en/admin-settings/authentication/microsoft-adfs/rancher-adfs-setup
Далее: Настройка Rancher для Microsoft AD FS
10

[^1]: 
[^2]: 
[^3]: 