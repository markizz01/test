


|**Название**|**Вес**|
| :- | :- |
|<p>[Cluster Templates](https://github.com/rancher/docs/blob/master/content/rancher/v2.6/en/admin-settings/cluster-templates/_index.md) </p><p>Шаблоны кластеров[^1]</p>|100|


[**Обзор](#_1v6n0eds0gg3)	**1****

[Дистрибутив Kubernetes](#_2j5ifrw1ptrt)	2

[Управление версиями](#_ud9jvrmopb8w)	2

[**Шаблон кластера RKE2](#_en30wh661uic)	**2****

[**Добавление шаблона кластера в Rancher](#_f4l092evbhr)	**2****

[**Создание кластера из шаблона кластера](#_38jiub6ndzdh)	**3****

[**Обновление кластера, созданного на основе шаблона кластера](#_r4t6qo6e290b)	**4****

[**Развертывание кластеров из шаблона с помощью Fleet](#_5fn3udepodt2)	**4****

[**Удаление шаблонов кластера](#_52e72zf0qf9x)	**4****

[**Параметры настройки](#_iehjlza1l82t)	**5****

Шаблоны кластера охватывают как конфигурацию Kubernetes, так и конфигурацию пула узлов. Поэтому один шаблон может содержать всю информацию, необходимую Rancher для настройки новых узлов в облачном провайдере и установки Kubernetes на этих узлах.
# Обзор
`	`Шаблоны кластеров предоставляются в виде *чартов Helm* (Helm chart). Чтобы использовать их, вам нужно будет клонировать шаблоны и создать их форки, изменить их в соответствии с вашим вариантом использования, а затем установить чарты Helm в кластер управления Rancher. После того, как чарт Helm будет установлен в кластере управления Rancher, будет создан новый ресурс кластера, который Rancher будет использовать для настройки нового кластера.

`	`После подготовки кластера с использованием шаблона никакие изменения в шаблоне не повлияют на кластер. После того, как кластер будет создан на основе шаблона кластера, его конфигурация и инфраструктура могут измениться (шаблоны кластера не накладывают никаких ограничений).

## Дистрибутив Kubernetes
`	`Шаблоны кластеров могут использовать любой дистрибутив Kubernetes. На данный момент приводится пример с кластером Kubernetes RKE2. Возможно, в будущем будет приведено больше примеров с другими дистрибутивами Kubernetes.
## Управление версиями
`	`Rancher не управляет контролем версий для шаблонов кластера. Контроль версиями осуществляется в репозитории, содержащем Helm-чарт шаблона.
# Шаблон кластера RKE2
`	`Репозиторий-пример для шаблона кластера RKE2 находится здесь. Начиная с версии Rancher v2.6.0, мы предоставляем шаблон кластера RKE2 (возможно, в будущем будет добавлено большее количество примеров).
# Добавление шаблона кластера в Rancher
`	`В этом разделе вы узнаете, как добавить шаблон кластера в список репозиториев чартов кластера local. В результате Rancher будет предлагать для использования этот шаблон кластера, когда пользователи будут устанавливать новые кластеры Kubernetes.

***Предварительные требования:***

- *Вам потребуется разрешение на установку чартов Helm в Kubernetes-кластере local, в котором установлен Rancher.*
- *Чтобы чарт отображался в форме для создания новых кластеров, он должен иметь аннотацию catalog.cattle.io/type: cluster-template.*

1. Перейдите в репозиторий примеров шаблонов кластера. Примеры Rancher находятся в этом репозитории GitHub. Начиная с версии Rancher v2.6.0, мы предоставляем шаблон кластера RKE2 (в будущем будет добавлено больше примеров).
1. Создайте форк репозитория.
1. Опционально: Отредактируйте параметры кластера, отредактировав файл values.yaml. Для получения справки по редактированию файла обратитесь к README по Helm-чарту шаблона кластера.
1. Добавьте репозиторий чартов в Rancher. Нажмите **☰>Cluster Management** (управление кластером).
1. Перейдите в кластер local и нажмите **Explore** (изучить).
1. На левой панели навигации выберите **Apps & Marketplace > Chart Repositories** (Приложения и Маркетплейс > Репозиторий чартов).
1. Нажмите **Create** (создать).
1. Введите название для репозитория шаблонов кластера.
1. Нажмите **Git Repository containing Helm chart definitions** (репозиторий Git, содержащий определения чартов Helm).
1. В поле **Git Repo URL** (URL Git-репозитория) введите URL репозитория. Например, https://github.com/rancher/cluster-template-examples.git.

1. В поле **Git Branch** (ветка Git) введите ветку, которую вы хотите использовать в качестве источника для шаблона. В репозитории-примере используется ветка  main.
1. Нажмите **Create** (создать).

`	`Результат: Шаблон кластера доступен из **Apps & Marketplace** (Приложения и Маркетплейс) в кластере local Rancher. Теперь его можно использовать для развертывания кластеров.

***Доступ администратора с ограниченными правами**: Если вы являетесь администратором с ограниченными правами и не имеете доступа к кластеру local, вы все равно можете добавлять новые шаблоны RKE2 и управлять репозиториями кластера. Чтобы обратиться к репозиторию чартов, перейдите на левую панель навигации и нажмите **☰> Cluster Management** > **Advanced** > **Repositories** (Управление кластером > Дополнительные > Репозитории). Пропустите шаги 1-6 из инструкции выше и сразу перейдите к шагам 7-12 для создания шаблона кластера.*
# Создание кластера из шаблона кластера
***Предварительные требования:***

- *Вам потребуется разрешение на создание новых кластеров Kubernetes.*
- *Вам понадобятся учетные данные облака для подготовки инфраструктуры с использованием шаблона.*
- *Чтобы Helm-чарт шаблона кластера мог быть отображен в форме для создания новых кластеров, он должен содержать аннотацию catalog.cattle.io/type: cluster-template.*

1. Нажмите **☰>Cluster Management** (управление кластером),
1. На странице **Clusters** (кластеры) нажмите **Create** (создать).
1. Нажмите на имя вашего шаблона кластера.
1. Завершите установку Helm-чарта.

**Результат:** После того, как Rancher создает новый кластер, он управляется так же, как и любой другой запущенный Rancher кластер Kubernetes. Вы можете настроить любые параметры через пользовательский интерфейс, если в шаблоне кластера есть параметры, которые пользователь может выбирать.
# Обновление кластера, созданного на основе шаблона кластера
`	`Вы можете обновить любые кластеры с помощью шаблона на странице **Apps & Marketplace > Installed Apps** (Приложения и Маркетплейс > Установленные приложения), учитывая, что в этих кластерах используется новая версия шаблона.
# Развертывание кластеров из шаблона с помощью Fleet
***Предварительные требования:***

- *Вам потребуется разрешение на создание новых кластеров Kubernetes.*
- *Вам понадобятся учетные данные облака для подготовки инфраструктуры с использованием шаблона.*
- *Чтобы быть отображенным в форме для создания новых кластеров, Helm-чарт шаблона кластера должен содержать аннотацию catalog.cattle.io/type: cluster-template.*
- *Чтобы использовать шаблон как часть непрерывной доставки (continuous delivery) или GitOps, шаблон кластера должен быть развернут в локальном пространстве имен fleet-local кластера local.*
- *Все значения должны быть заданы в values.yaml шаблона.*
- *Fleet-репозитории должны соответствовать [данным рекомендациям](http://fleet.rancher.io/gitrepo-structure/). Для шаблонов кластеров RKE2 это означает, что файл fleet.yaml должен быть добавлен в репозиторий.* 

1. Нажмите **☰>Cluster Management** (управление кластером),
1. На странице **Clusters** (кластеры) нажмите **Create** (создать).
1. Нажмите **Create Cluster from Template** (создать кластер из шаблона).



**Результат:** После того, как Rancher создаст новый кластер, им будет управлять Fleet.
# Удаление шаблонов кластера
1. Нажмите **☰>Cluster Management** (управление кластером),
1. Перейдите в кластер local и выберите **Apps & Marketplace > Chart Repositories** (Приложения и Маркетплейс > Репозитории чартов).
1. Перейдите в репозиторий чартов для вашего шаблона кластера и нажмите **⋮> Delete** (удалить).
1. Подтвердите удаление.

**Результат:** Шаблон кластера удален. Это действие не влияет на кластеры, созданные с помощью шаблона кластера.

`	`Администратор, имеющий доступ к кластеру local, также может удалить кластер, развернутый с помощью шаблонов кластера, на странице **Apps & Marketplace** **> Installed Apps** (Приложения и Маркетплейс > Установленные приложения).
# Параметры настройки
Шаблоны кластера достаточно гибки, чтобы их можно было использовать для настройки всех следующих параметров, таких как

- конфигурация узла,
- пулы узлов,
- предварительно заданные учетные данные облака,
- включение/настройка авторизованной конечной точки (endpoint) кластера для получения доступа kubectl к кластеру без использования Rancher в качестве прокси-сервера,
- установка Rancher V2 monitoring,
- версия Kubernetes,
- назначение членов кластера,
- конфигурация инфраструктуры, такая как AWS VPC/подсети или центр обработки данных vSphere,
- параметры облачного провайдера,
- параметры безопасности Pod,
- сетевые провайдеры,
- контроллеры Ingress,
- конфигурация сетевой безопасности,
- сетевые плагины,
- URL-адрес частного реестра и учетные данные,
- дополнения,
- параметры Kubernetes, включающие конфигурации для компонентов Kubernetes, таких как kube-api, kube-controller, kubelet и сервисы.

Для получения подробной информации о том, как настроить шаблон, обратитесь к README по Helm-чарту шаблона кластера.


[^1]: 