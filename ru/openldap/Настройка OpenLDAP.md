


|**Название**|**Вес**|
| :- | :- |
|<p>Настройка OpenLDAP[^1]</p>|1113|


1.  [**Предварительные требования**](https://github.com/markizz01/test/blob/main/ru/openldap/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0%20OpenLDAP.md#%D0%BF%D1%80%D0%B5%D0%B4%D0%B2%D0%B0%D1%80%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)
2.  [**Настройка OpenLDAP в Rancher**](https://github.com/markizz01/test/blob/main/ru/openldap/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0%20OpenLDAP.md#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-openldap-%D0%B2-rancher)
    +  [Тестирование аутентификации](https://github.com/markizz01/test/blob/main/ru/openldap/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0%20OpenLDAP.md#%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8)
3.  [**Приложение: Устранение неполадок**](https://github.com/markizz01/test/blob/main/ru/openldap/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0%20OpenLDAP.md#%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-%D1%83%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BD%D0%B5%D0%BF%D0%BE%D0%BB%D0%B0%D0%B4%D0%BE%D0%BA)


Если ваша организация использует LDAP для аутентификации пользователей, вы можете настроить Rancher, чтобы он взаимодействовал с сервером OpenLDAP для аутентификации пользователей. Это позволяет администраторам Rancher контролировать доступ к кластерам и проектам. Для этого используются пользователи и группы, управление которыми происходит извне в центральном пользовательском репозитории организации. При этом конечные пользователи при входе в пользовательский интерфейс Rancher смогут проходить аутентификацию с помощью своих учетных данных LDAP. 

# Предварительные требования
Rancher должен быть настроен с учетной записью LDAP для подключения  (LDAP bind account), то есть учетной записью сервиса. Это необходимо, чтобы можно было выполнять поиск и извлечение записей LDAP, относящихся к пользователям и группам, которые должны иметь доступ. Для этой цели рекомендуется не использовать учетную запись администратора или личную учетную запись, а вместо этого создать специальную учетную запись в OpenLDAP с доступом только на чтение пользователей и групп в настроенной базе поиска (см. ниже).

***Использование TLS?***

*Если сертификат, используемый сервером OpenLDAP, является самоподписанным (self-signed) или получен не от общепризнанного центра сертификации, убедитесь, что у вас под рукой есть сертификат CA (объединенный с любыми промежуточными сертификатами) в формате PEM. Вам нужно будет вставить этот сертификат во время настройки, чтобы Rancher мог проверить цепочку сертификатов.*

# Настройка OpenLDAP в Rancher
Настройте параметры для сервера OpenLDAP, групп и пользователей. Для получения информации по заполнению каждого поля обратитесь к справке по настройке OpenLDAP.

*Прежде чем приступить к настройке, пожалуйста, ознакомьтесь с концепциями  из раздела "Внешняя настройка аутентификации и пользователи-принципалы (principal user)".*

1. В левом верхнем углу нажмите **☰> Users & Authentication** (пользователи и аутентификация).
2. В левом навигационном меню выберите **Auth Provider** (поставщик аутентификации).
3. Нажмите **OpenLDAP**. Заполните форму **Configure an OpenLDAP server** (настройка сервера OpenLDAP). 
4. Нажмите **Enable**.
## Тестирование аутентификации
После завершения настройки приступайте к тестированию подключения к серверу OpenLDAP. Если тестирование пройдет успешно, аутентификация с помощью OpenLDAP будет включена неявным образом.

***Примечание:** Пользователь OpenLDAP, имеющий отношение к учетным данным, введенным на этом шаге, будет сопоставлен с учетной записью локальной принципала и ему будут присвоены привилегии администратора в Rancher. Поэтому необходимо принять взвешенное решение, какую учетную запись LDAP вы будете использовать для выполнения этого шага.*

1. Введите **username** (имя пользователя) и **password** (пароль) для учетной записи OpenLDAP, которая должна быть сопоставлена с учетной записью локального принципала.
2. Нажмите **Authenticate With OpenLDAP** (аутентификация с помощью OpenLDAP), чтобы протестировать соединение с OpenLDAP и завершить настройку.

**Результат:**

- Настроена аутентификация с помощью OpenLDAP.
- Пользователь LDAP, относящийся к введенным учетным данным, сопоставляется с (административной) учетной записью локального принципала.

***Примечание:** Вы по-прежнему сможете войти в систему, используя локально настроенную учетную запись admin и пароль в случае сбоя в работе сервисов LDAP.*
# Приложение: Устранение неполадок
Если у вас возникли проблемы при тестировании подключения к серверу OpenLDAP, сначала дважды проверьте учетные данные, введенные для учетной записи сервиса, а также конфигурацию базы поиска. Вы также можете просмотреть журналы Rancher, чтобы более точно определить причину проблемы. Журналы отладки (debug log) могут также содержать более подробную информацию об ошибке. Пожалуйста, обратитесь к разделу "Как я могу включить ведение журнала отладки" в этой документации.


[^1]: [Configuring OpenLDAP](https://github.com/rancher/docs/blob/master/content/rancher/v2.6/en/admin-settings/authentication/openldap/_index.md)
