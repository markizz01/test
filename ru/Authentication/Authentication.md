


|**Название**|**Вес**|
| :- | :- |
|<p>[Authentication](https://github.com/rancher/docs/blob/master/content/rancher/v2.6/en/admin-settings/authentication/_index.md) </p><p>Аутентификация[^1]</p>|10|


### [Внешняя vs. локальная аутентификация](https://github.com/markizz01/test/blob/main/ru/Authentication/Authentication.md#внешняя-vs-локальная-аутентификация-1)

### [Пользователи и группы](https://github.com/markizz01/test/blob/main/ru/Authentication/Authentication.md#пользователи-и-группы-1)

### [Границы авторизации в Rancher]

### [Внешняя настройка аутентификации и пользователи-принципалы]

Одной из ключевых функций, которые Rancher добавляет в Kubernetes, является централизованная аутентификация пользователя. Эта функция позволяет вашим пользователям использовать один набор учетных данных для аутентификации в любом из ваших кластеров Kubernetes.

  Эта централизованная аутентификация пользователя выполняется с помощью прокси-сервера аутентификации Rancher, который устанавливается вместе с остальной частью Rancher. Этот прокси-сервер проверяет подлинность ваших пользователей и пересылает их запросы в ваши кластеры Kubernetes, используя учетную запись службы.
# Внешняя vs. локальная аутентификация
  Прокси-сервер аутентификации Rancher интегрируется со следующими внешними сервисами аутентификации.


|**Сервис аутентификации**|
| :-: |
|Microsoft Active Directory|
|GitHub|
|Microsoft Azure AD|
|FreeIPA|
|OpenLDAP|
|Microsoft AD FS|
|PingIdentity|
|Keycloak (OIDC)|
|Keycloak (SAML)|
|Okta|
|Google OAuth|
|Shibboleth|

  Однако Rancher также предоставляет локальную аутентификацию. В большинстве случаев вам следует использовать внешний сервис аутентификации вместо локальной аутентификации, поскольку внешняя аутентификация позволяет управлять пользователями из центрального размещения (central location). Однако в редких случаях вам может потребоваться несколько пользователей локальной аутентификации для управления Rancher, например, если ваш внешний поставщик аутентификации недоступен или проходит техническое обслуживание.
# Пользователи и группы
  Rancher использует концепции пользователей и групп, чтобы определить, кому разрешено входить в Rancher и к каким ресурсам можно получить доступ. При аутентификации с помощью внешнего поставщика (external provider) группы предоставляются от внешнего поставщика на основе пользователей. Этим пользователям и группам назначаются определенные роли для таких ресурсов, как кластеры, проекты, многокластерные приложения, а также глобальные поставщики DNS и записи. Когда вы предоставляете доступ к группе, все пользователи, являющиеся членами этой группы в поставщике аутентификации, смогут получить доступ к ресурсу с указанными вами разрешениями. Дополнительные сведения о ролях и разрешениях см. в разделе "Управление доступом на основе ролей".

***Примечание:** Локальная аутентификация не поддерживает создание групп или управление ими.*

  Дополнительные сведения см. в разделе Пользователи и группы.

# Границы авторизации в Rancher
  После того, как в Rancher будет разрешен вход с использованием внешнего сервиса аутентификации, необходимо настроить, кому будет разрешено входить в систему и использовать Rancher. Доступны следующие опции:


|**Уровень доступа**|**Описание**|
| :-: | :-: |
|<p>разрешить любым валидным пользователям</p><p>Allow any valid Users[^2]</p>|Любой пользователь в сервисе авторизации может получить доступ к Rancher. Как правило, мы не рекомендуем использовать этот параметр!|
|<p>разрешить участникам кластеров, проектов, а также авторизованным пользователям и организациям</p><p>Allow members of Clusters, Projects, plus Authorized Users and Organizations[^3]</p>|Любой пользователь в сервисе авторизации и любая группа, добавленная в качестве **Cluster Member** (член кластера) или **Project Member** (участник проекта), могут войти в Rancher. Кроме того, любой пользователь сервиса аутентификации или группы, которую вы добавляете в список **Authorized Users and Organizations** (авторизованные пользователи и организации), может войти в Rancher.|
|<p>ограничить доступ только для авторизованных пользователей и организаций</p><p>Restrict access to only Authorized Users and Organizations[^4]</p>|Войти в Rancher могут только пользователи сервиса аутентификации или группы, добавленные в **Authorized Users and Organizations** (авторизованные пользователи и организации).|

  Чтобы установить уровень доступа Rancher для пользователей в сервисе авторизации, выполните следующие действия:

1. В верхнем левом угле нажмите **☰> Users & Authentication** (пользователи и аутентификация).
1. На левой панели навигации выберите **Auth Provider** (поставщик авторизации).
1. После настройки сведений о конфигурации для поставщика авторизации используйте параметры **Site Access** (доступ к сайту), чтобы настроить область авторизации пользователя. В таблице выше описан уровень доступа для каждого параметра.
1. Дополнительно: Если вы выберете параметр, отличный от **Allow any valid Users** (разрешить любым валидным пользователям), вы можете добавить пользователей в список **Authorized Users and Organizations** (авторизованные пользователи и организации), с помощью поиска их в появившемся текстовом поле.
1. Нажмите **Save** (сохранить).

**Результат:** Применены параметры конфигурации доступа Rancher.


# Внешняя настройка аутентификации и пользователи-принципалы
Для настройки внешней аутентификации требуются:

- локальный пользователь, которому назначена роль администратора, именуемый далее *локальным принципалом* (local principal);
- внешний пользователь, именуемый далее *внешним принципалом* (external principal), который может проходить аутентификацию с помощью вашего внешнего сервиса аутентификации.

  Настройка внешней аутентификации влияет на то, как в Rancher происходит управление пользователями-принципалами. Для лучшего понимания изучите приведенный ниже список.

1. Войдите в Rancher в качестве локального принципала и завершите настройку внешней аутентификации.

![image](https://user-images.githubusercontent.com/119851242/207583431-9bf18187-bf47-463c-ba4f-4fd8374369ef.png)


2. Rancher связывает внешнего принципала с локальным принципалом. Эти два пользователя совместно используют идентификатор пользователя локального принципала.

![image](https://user-images.githubusercontent.com/119851242/207583465-58b3e47b-5da2-4945-bb95-2464d7465522.png)


3. После завершения настройки Rancher автоматически выходит из локального принципала.

![image](https://user-images.githubusercontent.com/119851242/207583496-551ee87d-024f-436f-a223-88dcfde9ea91.png)


4. Затем Rancher автоматически вернет вас обратно в качестве внешнего принципала.

![image](https://user-images.githubusercontent.com/119851242/207583539-4c62d803-1082-42a8-89e8-a900815ed359.png)


5. Поскольку внешний принципал и локальный принципал имеют общий идентификатор, на странице **Users** (пользователи) не отображается уникальный объект для внешнего принципала.

![image](https://user-images.githubusercontent.com/119851242/207583566-379c620c-f018-4bc6-b889-dd95b1fb78e3.png)


6. Внешний принципал и локальный принципал имеют одинаковые права доступа.


 
