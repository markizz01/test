Внутренний реестр Docker конвейера и рабочие нагрузки Minio по умолчанию используют эфемерные тома. Это хранилище по умолчанию работает «из коробки» и упрощает тестирование, но вы теряете образы сборки и журналы сборки, если происходит сбой узла, на котором работает реестр Docker или Minio. В большинстве случаев это нормально. Если вы хотите, чтобы образы и журналы сборки сохранялись при сбоях узлов, вы можете настроить реестр Docker и Minio для использования постоянных томов.

В этом разделе предполагается, что вы понимаете, как работает постоянное хранилище в Kubernetes. Для получения дополнительной информации обратитесь к разделу [о том, как работает хранилище.](https://github.com/rancher/docs/blob/master/content/rancher/v2.6/en/pipelines/storage/%7B%7B%3Cbaseurl%3E%7D%7D/rancher/v2.6/en/cluster-admin/volumes-and-storage/how-storage-works)

# Предпосылки (для обеих частей A и B):
Для кластера должны быть доступны постоянные тома .

## А. Настройка постоянных данных для реестра Docker
1.	Щелкните **☰ > Cluster Management( Управление кластером) .**
2.	Перейдите к созданному вами кластеру и нажмите **Explore (Исследовать).**
3.	Щелкните **Workload (Рабочая нагрузка) .**
4.	Найдите рабочую нагрузку **docker-registry** и выберите **⋮ > Edit (Изменить) .**
5.	Прокрутите до раздела **« Volumes (Тома) »** и разверните его. Выберите один  из следующих вариантов в меню **«Add Volume (Добавить том) »**, которое находится в нижней части раздела:
    -	Добавить том >  Add a new persistent volume  (Добавить новый постоянный том) (claim -требование)
    -	Добавить том > Use an existing persistent volume (Использовать существующий постоянный том) (требование)
6.	Заполните появившуюся форму, чтобы выбрать постоянный том для внутреннего реестра Docker. 


**Add a new persistent volume**

1. Введите **Имя** для заявки на том/объем.
    1.	Выберите объем претензии **Source (Источник) :**
      o	Если вы выберете **Use a Storage Class to provision a new persistent volume (Использовать класс хранилища для предоставления нового постоянного тома)** , выберите класс хранения и введите **Capacity (вместимость).**
      o	Если вы выберете **Use an existing persistent volume («Использовать существующий постоянный том »)**, выберите **« Постоянный том » в раскрывающемся списке.**
    2.	В разделе **«Customize (Настройка) »** выберите доступ для чтения/записи к тому.
    3.	Щелкните **Define (Определить) .**


**Use an existing persistent volume**

1.	Введите **имя** для заявки на объем.
2.	В раскрывающемся списке выберите **« Persistent Volume Claim (Постоянная заявка на том)».**
3.	В разделе **«Customize (Настройка) »** выберите доступ для чтения/записи к тому.
4.	Щелкните **Define (Определить) .**


1.	В поле **Mount Point** введите /var/lib/registry, который является путем хранения данных внутри контейнера реестра Docker.
2.	Щелкните **Upgrade. (Обновить) .**

## B. Настройка постоянных данных для Minio
1.	Щелкните **☰ > Управление кластером .**
2.	Перейдите к созданному вами кластеру и нажмите **Исследовать .**
3.	Щелкните **Рабочая нагрузка .**
4.	Перейдите к minio рабочей нагрузке minio и выберите **⋮ > Изменить .**
5.	Прокрутите до раздела **« Тома »** и разверните его. 

Сделайте один из следующих вариантов в меню **« Добавить том »**, которое находится в нижней части раздела:
-	Добавить том > Добавить новый постоянный том (требование/претензия)
-	Добавить том > Использовать существующий постоянный том (претензия)

6.	Заполните появившуюся форму, чтобы выбрать постоянный том для внутреннего реестра Docker.


**Add a new persistent volume**

1.	Введите **имя** для заявки на объем.
2.	Выберите объем претензии **Источник :**
    -	Если вы выберете Использовать класс хранилища для предоставления нового постоянного тома , выберите класс хранения и введите Емкость .
    -	Если вы выберете «Использовать существующий постоянный том », выберите « Постоянный том » в раскрывающемся списке.
3.	В разделе **« Настройка »** выберите доступ для чтения/записи к тому.
4.	Щелкните **Определить .**


**Использовать существующий постоянный том**


1.	Введите **имя** для заявки на объем.
2.	В раскрывающемся списке выберите **« Постоянная заявка на том».**
3.	В разделе **« Настройка »** выберите доступ для чтения/записи к тому.
4.	Щелкните **Определить .**


**Use an existing persistent volume**

1.	В поле **Mount Point** введите  путь хранения данных /data внутри контейнера Minio.
2.	Щелкните **Обновить .**


**Результат:** постоянное хранилище настроено для компонентов конвейера.

